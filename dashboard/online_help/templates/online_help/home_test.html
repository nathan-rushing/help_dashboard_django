{% extends 'online_help/base.html' %}
{% block content %}
{% load static custom_filters %}

<link rel="stylesheet" href="{% static 'css/home.css' %}">
<h1>Radiant Help Dashboard</h1>

<div style="display: flex; align-items: center; gap: 10px;">
  <h5>Version:</h5>
  <h5 id="version-text">2025.1</h5>
  <input type="text" id="version-input" style="display: none; width: 80px;" />
  <button class="btn btn-outline-dark btn-sm" onclick="toggleEdit()">Edit</button>
</div>



<div class="p-3" style="position: sticky; top: 30px; z-index: 1000;">
    <input type="text" id="searchInput" class="form-control" placeholder="Search sections or subsections..." onkeyup="filterContent()">
</div>

<div class="container mt-4">
    <div class="row">
        {% for writer in writers %}
            <div class="col-md-6 mb-4">
                <div class="bg-light rounded scroll-box">
                    <div class="p-3 text-white text-center" style="background-color: #0747a6;">
                        <p class="m-0">
                            <a href="{% url 'online_help:per_user_test' writer.pk %}" class="hover-link">{{ writer.writer_name }}</a>
                        </p>
                    </div>
                    <div class="p-2">
                        {% with writer_tasks_grouped|get_item:writer.pk as documents %}
                            {% if documents %}
                                {% for document, tasks in documents.items %}
                                    <h5>{{ document }}</h5>
                                    <table class="table table-bordered mb-3">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>Section</th>
                                                <th>Sub</th>
                                                <th>Color</th>
                                                <th>Completion</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for tk in tasks %}
                                                <tr>
                                                    <td>{{ tk.task.section }}</td>
                                                    <td>
                                                        <a href="{% url 'online_help:per_subsection_test' tk.writer.pk tk.task.pk %}" class="hover-link">
                                                            {{ tk.task.sub_section }}
                                                        </a>
                                                    </td>
                                                    <td>{{ tk.task.color }}</td>
                                                    <td>{{ tk.task.completion }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                {% endfor %}
                            {% else %}
                                <p>No tasks assigned.</p>
                            {% endif %}
                        {% endwith %}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<script>
  let editing = false;

  // Load saved version from localStorage on page load
  window.onload = function () {
    const savedVersion = localStorage.getItem('version');
    if (savedVersion) {
      document.getElementById('version-text').textContent = savedVersion;
    }
  };

  function toggleEdit() {
    const versionText = document.getElementById('version-text');
    const versionInput = document.getElementById('version-input');
    const button = event.target;

    if (!editing) {
      versionInput.value = versionText.textContent;
      versionText.style.display = 'none';
      versionInput.style.display = 'inline-block';
      button.textContent = 'Save';
    } else {
      const newVersion = versionInput.value;
      versionText.textContent = newVersion;
      versionText.style.display = 'inline-block';
      versionInput.style.display = 'none';
      button.textContent = 'Edit';

      // Save to localStorage
      localStorage.setItem('version', newVersion);
    }

    editing = !editing;
  }
</script>


<script>
function filterContent() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    const headings = document.querySelectorAll("h5");
    const tables = document.querySelectorAll("table");

    headings.forEach((heading, index) => {
        const table = tables[index];
        const rows = table.querySelectorAll("tbody tr");
        let tableHasMatch = false;

        const headingMatch = heading.innerText.toLowerCase().includes(input);

        rows.forEach(row => {
            const text = row.innerText.toLowerCase();
            const match = text.includes(input);
            row.style.display = match ? "" : "none";
            if (match) tableHasMatch = true;
        });

        heading.style.display = headingMatch || tableHasMatch ? "" : "none";
        table.style.display = tableHasMatch ? "" : "none";
    });
}
</script>

{% endblock %}
