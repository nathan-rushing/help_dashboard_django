{% extends 'online_help/base.html' %}
{% block content %}
{% load static %}
{% load static custom_filters %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<h1>Radiant Help Dashboard</h1>

<div class="p-3" style="position: sticky; top: 30px; z-index: 1000;">
    <input type="text" id="searchInput" class="form-control" placeholder="Search sections or subsections..." onkeyup="filterContent()">
</div>

<div class="container mt-4">
    <div class="row">
        {% for writer in writers %}
        <div class="col-md-6 mb-4">
            <div class="bg-light rounded scroll-box">
                <div class="p-3 text-white text-center" style="background-color: #0747a6;">
                    <p class="m-0">
                        <a href="{% url 'online_help:per_user_test' writer.pk %}" class="hover-link">{{ writer.writer_name }}</a>
                    </p>
                </div>
                <div class="p-2">
                    {% for tk in writer_tasks|get_item:writer.pk %}
                        <h5>{{ tk.task.document }}</h5>
                        <table class="table table-bordered mb-3">
                            <thead class="thead-light">
                                <tr>
                                    <th>Section</th>
                                    <th>Sub</th>
                                    <th>Color</th>
                                    <th>Completion</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ tk.task.section }}</td>
                                    <td>
                                        <a href="{% url 'online_help:per_subsection_test' tk.writer.pk tk.task.pk %}" class="hover-link">
                                            {{ tk.task.sub_section }}
                                        </a>
                                    </td>
                                    <td>{{ tk.task.color }}</td>
                                    <td>From DB</td>
                                </tr>
                            </tbody>
                        </table>
                    {% empty %}
                        <p>No tasks assigned.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
function filterContent() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    const headings = document.querySelectorAll("h5");
    const tables = document.querySelectorAll("table");

    headings.forEach((heading, index) => {
        const table = tables[index];
        const rows = table.querySelectorAll("tbody tr");
        let tableHasMatch = false;

        const headingMatch = heading.innerText.toLowerCase().includes(input);

        rows.forEach(row => {
            const text = row.innerText.toLowerCase();
            const match = text.includes(input);
            row.style.display = match ? "" : "none";
            if (match) tableHasMatch = true;
        });

        heading.style.display = headingMatch || tableHasMatch ? "" : "none";
        table.style.display = tableHasMatch ? "" : "none";
    });
}
</script>
{% endblock %}
